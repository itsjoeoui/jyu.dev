---
import { personalData } from "@/data/personal";
import { getBaseRouteName } from "@/utils/getBaseRouteName";
import { getSession } from "auth-astro/server";
import { SignIn, SignOut } from "auth-astro/components";

const session = await getSession(Astro.request);

const currentRoute = Astro.url.pathname;

type Route = {
  name: string;
  path: string;
};

const routes: Route[] = [
  {
    name: "Home",
    path: "/",
  },
  {
    name: "Posts",
    path: "/posts",
  },
  {
    name: "Feed",
    path: "/feed",
  },
];
---

<div>
  <a href={`mailto:${personalData.email}`} class="hover:text-neutral-100"
    >{personalData.email}</a
  >
  <div class="py-1"></div>
  <div class="flex gap-2 max-w-xl">
    {
      routes.map((route, idx) => {
        if (idx === routes.length - 1) {
          return (
            <a
              href={route.path}
              class:list={{
                ["hover:text-neutral-100"]: true,
                ["text-neutral-100"]:
                  getBaseRouteName(currentRoute) === route.path,
              }}
            >
              {route.name}
            </a>
          );
        }
        return (
          <>
            <a
              href={route.path}
              class:list={{
                ["hover:text-neutral-100"]: true,
                ["text-neutral-100"]:
                  getBaseRouteName(currentRoute) === route.path,
              }}
            >
              {route.name}
            </a>
            <div>/</div>
          </>
        );
      })
    }
    <div class="grow"></div>
    {
      session ? (
        <SignOut>
          <div class="hover:text-neutral-100">Log Out</div>
        </SignOut>
      ) : (
        <SignIn provider={"github"}>
          <div class="hover:text-neutral-100">Log In</div>
        </SignIn>
      )
    }
  </div>
</div>
